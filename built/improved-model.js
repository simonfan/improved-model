//     swtch
//     (c) simonfan
//     swtch is licensed under the MIT terms.

//     Iterator
//     (c) simonfan
//     Iterator is licensed under the MIT terms.

//     Deep
//     (c) simonfan
//     Deep is licensed under the MIT terms.

//     Containers
//     (c) simonfan
//     Containers is licensed under the MIT terms.

//     ObjectMatcher
//     (c) simonfan
//     ObjectMatcher is licensed under the MIT terms.

//     improved-model
//     (c) simonfan
//     improved-model is licensed under the MIT terms.

define("__swtch/evaluate",["require","exports","module","lodash"],function(e,t){function n(){return r.find(this.cases,function(e){return"default"===e.condition})}var r=e("lodash");t.first=function(e){var t=r.find(this.cases,function(t){return this.match(t.condition,e)},this);return t=t||n.call(this)},t.all=function(e){var t=r.filter(this.cases,function(t){return this.match(t.condition,e)},this);if(0===t.length){var i=n.call(this);i&&t.push(i)}return t}}),define("__swtch/exec",["require","exports","module","lodash"],function(e,t){var n=e("lodash");t.execFirst=function(e){var t=this.first(e);return t?this.execCase(t,e):void 0},t.exec=function(e){var t=this.all(e);return n.map(t,function(t){return this.execCase(t,e)},this)},t.execCase=function(e){return e.value.call(e.context)}}),define("swtch",["require","exports","module","lodash","subject","./__swtch/evaluate","./__swtch/exec"],function(e,t,n){var r=e("lodash"),i=e("subject"),o=n.exports=i({initialize:function(e){this.cases=[],r.each(e,function(e){this.when(e.condition,e.value)},this)},match:function(e,t){return r.isRegExp(e)?e.test(t):r.isFunction(e)?e(t):e===t},when:function(){var e;return e=1===arguments.length&&r.isObject(arguments[0])?arguments[0]:{condition:arguments[0],value:arguments[1],context:arguments[2]},this.cases.push(e),this},d_fault:function(e,t){return this.when("default",e,t),this}});o.assignProto(e("./__swtch/evaluate")).assignProto(e("./__swtch/exec"))}),define("iterator/base",["subject","lodash"],function(e,t){var n=e({initialize:function(e,t){this.data=e,t=t||{},this.currentIndex=t.startAt||-1,this.options=t,this.evaluate=t.evaluate||t.evaluator||this.evaluate},move:function(e){return this.index(this.currentIndex+e),this},evaluate:function(e){return e},evaluator:function(e){return this.evaluate=e,this},start:function(){return this.currentIndex=-1,this},end:function(){return this.currentIndex=this.length(),this},index:function(e){if(e>this.length()-1||0>e)throw new Error("No such index "+e);return this.currentIndex=e,this},countBefore:function(){return this.currentIndex+1},countAfter:function(){return this.length()-(this.currentIndex+1)},range:function(e,t){for(var n=[];t>=e;)n.push(this.at(e)),e++;return n},hasNext:function(){return this.currentIndex<this.length()-1},next:function(){return this.move(1),this.current()},nextN:function(e){for(var t=[],n=this.currentIndex+e-1;this.hasNext()&&this.currentIndex<=n;)t.push(this.next());return t},hasPrevious:function(){return this.currentIndex>0},previous:function(){return this.move(-1),this.current()},previousN:function(e){for(var t=[],n=this.currentIndex-e+1;this.hasPrevious()&&this.currentIndex>=n;)t.push(this.previous());return t},current:function(){return this.at(this.currentIndex)},value:function(){return this.data}});n.proto({hasPrev:n.prototype.hasPrevious,prev:n.prototype.previous,prevN:n.prototype.previousN});var r=["map","filter","compact","difference"];return t.each(r,function(e){n.proto(e,function(){var n=t(this.data);n=n[e].apply(n,arguments);var r=this.constructor(n.value());return r})}),n}),define("iterator/array",["require","exports","module","./base","lodash"],function(e){var t=e("./base"),n=e("lodash"),r=t.extend({at:function(e){return this.evaluate(this.data[e],e)},length:function(){return this.data.length}}),i=["push","reverse","shift","sort","splice","unshift"];return n.each(i,function(e){r.proto(e,function(){return this.data[e].apply(this.data,arguments),this})}),n.each(["concat","slice"],function(e){r.proto(e,function(){var t=this.data[e].apply(this.data,arguments);return this.constructor(t)})}),r}),define("iterator/object",["require","exports","module","./base","lodash"],function(e){var t=e("./base"),n=e("lodash"),r=t.extend({initialize:function(e,r){r=r||{},t.prototype.initialize.apply(this,arguments),this.order=r.order||n.keys(e)},keyAt:function(e){return this.order[e]},at:function(e){var t=this.keyAt(e),n=this.data[t];return this.evaluate(n,t)},length:function(){return this.order.length},nextKey:function(){return this.keyAt(this.currentIndex+1)},currentKey:function(){return this.keyAt(this.currentIndex)},previousKey:function(){return this.keyAt(this.currentIndex-1)},map:function(e){var t={};return n.each(this.order,function(n,r){t[n]=e(this.data[n],n,r)}.bind(this)),this.constructor(t)}});return r.proto("constructor",r),r}),define("itr",["require","exports","module","./iterator/array","./iterator/object","lodash"],function(e){var t=e("./iterator/array"),n=e("./iterator/object"),r=e("lodash"),i=function(e){var i;return r.isArray(e)?i=t:r.isObject(e)&&(i=n),i.apply(this,arguments)};return i.object=n,i.array=t,i}),define("__deep__/keys",["require","exports","module"],function(){return function(e){return e.replace(/\[(["']?)([^\1]+?)\1?\]/g,".$2").replace(/^\./,"").split(".")}}),define("__deep__/walker",["require","exports","module","lodash","itr","./keys"],function(e,t,n){var r=e("lodash"),i=e("itr"),o=e("./keys"),u=i.object.extend({nextStep:function(){var e=new RegExp("^"+this.currentKey()+"\\.");return this.nextKey().replace(e,"")},currentStep:function(){var e=new RegExp("^"+this.previousKey()+"\\.");return this.currentKey().replace(e,"")},previousStep:function(){var e=this.previousKey()||"";return r.last(e.split("."))},remainingSteps:function(){var e=new RegExp("^"+this.currentKey()+"\\.");return this.destination().replace(e,"")},destination:function(){return r.last(this.order)}});n.exports=function(e,t){t=r.isArray(t)?t:o(t);var n={"":e},i=[""];return r.every(t,function(o,u){var s=r.first(t,u+1).join(".");return i.push(s),e=e[o],n[s]=e,!r.isUndefined(e)}),u(n,{order:i})}}),define("__deep__/getset",["require","exports","module","lodash","./keys"],function(e,t){var n=e("lodash"),r=e("./keys");t.get=function(e,t){return t=n.isArray(t)?t:r(t),n.reduce(t,function(e,t){return e[t]},e)},t.set=function(e,i,o){i=n.isArray(i)?i:r(i);var u=i.pop();e=t.get(e,i),e[u]=o}}),define("deep",["require","exports","module","lodash","./__deep__/keys","./__deep__/walker","./__deep__/getset"],function(e){var t=e("lodash"),n={};return n.parseKeys=e("./__deep__/keys"),n.walker=e("./__deep__/walker"),t.extend(n,e("./__deep__/getset")),n}),define("containers",["lodash"],function(){function e(e,t){return _.all(t,function(t){return _.contains(e,t)})}function t(e,t){return _.any(t,function(t){return _.contains(e,t)})}function n(e,t){return e[0]<t&&t<e[1]}function r(e,t){return e[0]<=t&&t<=e[1]}function i(e,t,i){var o=i?n:r;return o=_.partial(o,e),_.isArray(t)?_.every(t,o):o(t)}return{containsAll:e,containsAny:t,exclusiveWithin:n,inclusiveWithin:r,within:i}}),define("__object-query__/operators/match",["require","exports","module","lodash"],function(e,t){var n=e("lodash");t.$matchSingle=function(e,t){return n.isRegExp(e)?e.test(t):e===t},t.$match=function(e,r){return n.isArray(r)?n.any(r,function(n){return t.$matchSingle(e,n)}):t.$matchSingle(e,r)}}),define("__object-query__/operators/range",["require","exports","module"],function(e,t){t.$lt=function(e,t){return e>t},t.$lte=function(e,t){return e>=t},t.$gt=function(e,t){return t>e},t.$gte=function(e,t){return t>=e}}),define("__object-query__/operators/set",["require","exports","module","lodash","containers"],function(e,t){var n=e("lodash"),r=e("containers");t.$in=function(e,t){return n.isArray(t)?r.containsAny(e,t):n.contains(e,t)},t.$nin=function(e,t){return n.isArray(t)?!r.containsAny(e,t):!n.contains(e,t)},t.$all=function(e,t){return r.containsAll(t,e)}}),define("__object-query__/operators/boolean",["require","exports","module"],function(e,t){t.$e=function(){},t.$ne=function(){},t.$not=function(){},t.$or=function(){},t.$and=function(){},t.$exists=function(){}}),define("__object-query__/operators/index",["require","exports","module","lodash","deep","containers","./match","./range","./set","./boolean"],function(e,t){var n=e("lodash");e("deep"),e("containers"),n.extend(t,e("./match"),e("./range"),e("./set"),e("./boolean")),t.evaluateValue=function(e,r){return n.isObject(e)&&!n.isRegExp(e)?n.every(e,function(e,n){var i=t[n];if(i)return i(e,r);throw new Error("The operator "+n+" is not supported by object-query.")}):t.$match(e,r)}}),define("__object-query__/match",["require","exports","module","lodash","deep","./operators/index"],function(e,t,n){var r=e("lodash"),i=e("deep"),o=e("./operators/index"),u=/[0-9]+/,s=function(e,t,n){return r.any(t,function(t){return a(e,t,n)})},a=n.exports=function(e,t,n){for(var a,c=i.walker(t,n);c.hasNext();){var h=c.next();if(!c.hasNext()){a=o.evaluateValue(e,h);break}if(r.isArray(h)&&!u.test(c.nextStep())){a=s(e,h,c.remainingSteps());break}}return a}}),define("__object-query__/find",["require","exports","module","lodash","deep","./operators/index"],function(e,t,n){var r=e("lodash"),i=e("deep"),o=e("./operators/index"),u=/[0-9]+/,s=function(e,t,n){return r.any(t,function(t){return a(e,t,n)})},a=n.exports=function(e,t,n){for(var a,c=i.walker(t,n);c.hasNext();){var h=c.next();if(!c.hasNext()){a=o.evaluateValue(e,h);break}if(r.isArray(h)&&!u.test(c.nextStep())){a=s(e,h,c.remainingSteps());break}}return a}}),define("object-query",["require","exports","module","lodash","./__object-query__/match","./__object-query__/find"],function(e){function t(e,t){return r.every(e,function(e,n){return i(e,t,n)})}function n(e,n){return r.isArray(e)?r.any(e,function(e){return t(e,n)}):t(e,n)}var r=e("lodash"),i=e("./__object-query__/match");e("./__object-query__/find");var o=function(e){return e=e||{},r.partial(n,e)},u=["every","all","some","any","filter","find","reject"];return r.each(u,function(e){o[e]=function(t,n){return r[e](t,o(n))}}),o}),define("__improved-model/model-swtch/build-condition",["require","exports","module","object-query","lodash"],function(e,t,n){function r(e){var t=e.split(u),n=o.map(t,function(e){var t={};return o.each(e.split(s),function(e){var n=e.split(a);if(!n[1])throw new Error("No value found for "+r+" criterion.");var r=n[0],i=n[1].split(c);t[r]=i.length>1?i:i[0]}),t});return n}var i=e("object-query"),o=e("lodash"),u=/\s*\|\|\s*/g,s=/\s*&&\s*/g,a=/\s*:\s*/g,c=/\s*\|\s*/g;n.exports=function(e,t){return o.isString(t)&&(t=r(t)),o.partial(i(t),e.attributes)}}),define("__improved-model/model-swtch/build-callback",["require","exports","module","lodash"],function(e,t,n){function r(e,t){e.set(t)}var i=e("lodash");n.exports=function(e,t){return i.isFunction(t)?i.partial(t,e):i.partial(r,e,t)}}),define("__improved-model/model-swtch/index",["require","exports","module","swtch","lodash","./build-condition","./build-callback"],function(e,t,n){{var r=e("swtch"),i=e("lodash"),o=e("./build-condition"),u=e("./build-callback"),s=r.prototype.initialize,a=r.prototype.when;n.exports=r.extend({initialize:function(e,t){this.model=t.model;var n;i.isArray(e)?n=e:(n=[],i.each(e,function(e,t){n.push({condition:t,value:e})})),s.call(this,n)},when:function(e,t){var n=i.toArray(arguments);if("default"!==e){var r=o(this.model,e),s=u(this.model,t);n=[r,s].concat(n.slice(2))}return a.apply(this,n)}})}}),define("__improved-model/swtch",["require","exports","module","./model-swtch/index"],function(e,t){var n=e("./model-swtch/index");t.swtch=function(e){var t=n(e,{model:this}),r="all"===this.executionType?t.exec:t.execFirst;return this.on("change",function(e){r.call(t,e.attributes)}),r.call(t,this.attributes),t}}),define("improved-model",["require","exports","module","lowercase-backbone","lodash","./__improved-model/swtch"],function(e,t,n){var r=e("lowercase-backbone"),i=e("lodash"),o=r.model.prototype.initialize,u=["cases","executionType"],s=n.exports=r.model.extend({initialize:function(e,t){o.apply(this,arguments),t=t||{},i.each(u,function(e){this[e]=t[e]||this[e]},this),this.mainSwtch=this.swtch(this.cases)},executionType:"all",cases:{},when:function(e,t,n){return this.mainSwtch.when(e,t,n),this}});s.assignProto(e("./__improved-model/swtch"))});