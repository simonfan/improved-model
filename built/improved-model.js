//     pipe
//     (c) simonfan
//     pipe is licensed under the MIT terms.

//     improved-model
//     (c) simonfan
//     improved-model is licensed under the MIT terms.

define("__improved-model/model-swtch/build-condition",["require","exports","module","object-query","lodash"],function(t,i,e){function s(t){var i=t.split(o),e=n.map(i,function(t){var i={};return n.each(t.split(a),function(t){var e=t.split(c),s=e[0],r=e[1].split(u);if(!e[1])throw new Error("No value found for "+s+" criterion.");i[s]=r.length>1?r:r[0]}),i});return e}var r=t("object-query"),n=t("lodash"),o=/\s*\|\|\s*/g,a=/\s*&&\s*/g,c=/\s*:\s*/g,u=/\s*\|\s*/g;e.exports=function(t,i){return n.isString(i)&&(i=s(i)),n.partial(r(i),t.attributes)}}),define("__improved-model/model-swtch/build-callback",["require","exports","module","lodash"],function(t,i,e){function s(t,i){t.set(i)}var r=t("lodash");e.exports=function(t,i){return r.isFunction(i)?r.partial(i,t):r.partial(s,t,i)}}),define("__improved-model/model-swtch/index",["require","exports","module","swtch","lodash","./build-condition","./build-callback"],function(t,i,e){{var s=t("swtch"),r=t("lodash"),n=t("./build-condition"),o=t("./build-callback"),a=s.prototype.initialize,c=s.prototype.when;e.exports=s.extend({initialize:function(t,i){this.model=i.model;var e;r.isArray(t)?e=t:(e=[],r.each(t,function(t,i){e.push({condition:i,value:t})})),a.call(this,e)},when:function(t,i){var e=r.toArray(arguments);if("default"!==t){var s=n(this.model,t),a=o(this.model,i);e=[s,a].concat(e.slice(2))}return c.apply(this,e)}})}}),define("__improved-model/swtch",["require","exports","module","./model-swtch/index"],function(t,i){var e=t("./model-swtch/index");i.initializeIMSwtch=function(){this.mainSwtch=this.swtch(this.cases)},i.swtch=function(t){var i=e(t,{model:this}),s="all"===this.executionType?i.exec:i.execFirst;return this.on("change",function(t){s.call(i,t.attributes)}),s.call(i,this.attributes),i}}),define("__improved-model/virtual/prototype",["require","exports","module","lodash"],function(t,i){function e(t){return t}function s(t,i,e,s){var r=n.map(e,t.get,t),o=s.apply(t,r);t.set(i,o)}function r(t,i,r,o){o=o||t[i]||e,r=n.isArray(r)?r:[r];var a=n.map(r,function(t){return"change:"+t}).join(" ");t.on(a,n.partial(s,t,i,r,o)),s(t,i,r,o)}var n=t("lodash");i._virtualAttributes={},i.initializeIMVirtual=function(){this.virtual(this._virtualAttributes)},i.defineVirtualAttribute=function(){if(n.isObject(arguments[0]))n.each(arguments[0],function(t,i){var e,s;n.isObject(t)?(e=t.src,s=t.processor):e=t,r(this,i,e,s)},this);else if(n.isString(arguments[0])){var t=n.toArray(arguments);t.unshift(this),r.apply(null,t)}return this},i.virtual=i.defineVirtualAttribute}),define("__pipe/pump",["require","exports","module","lodash"],function(t,i){var e=t("lodash");i.pump=function(t,i){var s=this.maps.to,r=this.src,n=this.dest;t=t?e.pick(s,t):s;var o=i&&i.force;e.each(t,function(t,i){var s=this.srcGet(r,i);e.each(t,function(t){(o||!this.cacheCheck(i,s))&&this.destSet(n,t,s)},this)},this)}}),define("__pipe/drain",["require","exports","module","lodash"],function(t,i){var e=t("lodash");i.drain=function(){var t,i,s=arguments[0],r=arguments[1],n=this.maps.from;e.isArray(s)?(t=e.pick(n,s),i=r):e.isString(s)?(t={},t[s]=n[s],i=r):(t=n,i=s),i=i||{};var o=i.force;return this.src,this.dest,e.each(t,function(t,i){var e=this.destGet(this.dest,t[0]);(o||!this.cacheCheck(i,e))&&this.srcSet(this.src,i,e)},this),this}}),define("__pipe/inject",["require","exports","module","lodash"],function(t,i){var e=t("lodash");i.inject=function(t,i){if(!this.src)throw new Error("No src for pipe");e.each(t,function(t,e){(!this.cacheCheck(e,t)||i&&i.force)&&this.srcSet(this.src,e,t)},this),this.pump(null,{force:!0})}}),define("__pipe/map",["require","exports","module","lodash"],function(t,i){var e=t("lodash");i.mapSingle=function(t,i,s){i=e.isArray(i)?i:[i],s&&"both"!==s?this.maps[s][t]=i:(this.maps.to[t]=i,this.maps.from[t]=i)},i.map=function(){if(e.isString(arguments[0]))this.mapSingle.apply(this,arguments);else if(e.isObject(arguments[0])){var t=arguments[1];e.each(arguments[0],function(i,s){var r;e.isString(i)?r=i:(r=i.dest,t=i.direction||t),this.mapSingle(s,r,t)},this)}return this},i.unmap=function(t){return e.each(this.maps,function(i){delete i[t]}),this}}),define("__pipe/cache",["require","exports","module"],function(t,i){i.cacheClear=function(){return this.cache={},this},i.cacheCheck=function(t,i){return this.cache?this.cache[t]!==i?(this.cache[t]=i,!1):!0:!1}}),define("pipe",["require","exports","module","subject","lodash","./__pipe/pump","./__pipe/drain","./__pipe/inject","./__pipe/map","./__pipe/cache"],function(t,i,e){var s=t("subject"),r=(t("lodash"),e.exports=s({initialize:function(t,i,e,s){s=s||{},this.srcGet=this.srcGet||this.get,this.srcSet=this.srcSet||this.set,this.destGet=this.destGet||this.get,this.destSet=this.destSet||this.set,s.cache!==!1&&this.cacheClear(),this.maps={from:{},to:{}},t&&this.from(t),i&&this.to(i),e&&this.map(e,s.direction)},get:function(t,i){return t[i]},set:function(t,i,e){return t[i]=e,t},from:function(t){return this.cacheClear(),this.src=t,this},to:function(t){return this.cacheClear(),this.dest=t,this}}));r.assignProto(t("./__pipe/pump")).assignProto(t("./__pipe/drain")).assignProto(t("./__pipe/inject")).assignProto(t("./__pipe/map")).assignProto(t("./__pipe/cache"))}),define("__improved-model/pipe",["require","exports","module","pipe","lodash"],function(t,i){var e=t("pipe"),s=t("lodash"),r=e.extend({get:function(t,i){return t.get(i)},set:function(t,i,e){return t.set(i,e)}});i.initializeIMPipe=function(){s.bindAll(this,["pump"]),this.pipes=[],this.on("change",this.pump)},i.pump=function(){return s.each(this.pipes,function(t){t.pump()}),this},i.pipe=function(t,i,e){if(s.isString(i)){var n=i;i={},i[n]=n}var o=r(this,t,i,e);return this.pipes.push(o),o}}),define("__improved-model/virtual/static",["require","exports","module","lodash"],function(t,i){var e=t("lodash");i.defineVirtualAttribute=function(){return e.isObject(arguments[0])?e.assign(this.prototype._virtualAttributes,arguments[0]):this.prototype._virtualAttributes[arguments[0]]={src:arguments[1],processor:arguments[2]},this},i.extendVirtualAttributes=function(t){var i=e.create(this.prototype._virtualAttributes),s=this.extend({virtuals:i});return s.defineVirtualAttribute(t),s}}),define("improved-model",["require","exports","module","lowercase-backbone","lodash","./__improved-model/swtch","./__improved-model/virtual/prototype","./__improved-model/pipe","./__improved-model/virtual/static"],function(t,i,e){var s=t("lowercase-backbone"),r=t("lodash"),n=s.model.prototype.initialize,o=["cases","executionType"],a=e.exports=s.model.extend({initialize:function(t,i){n.apply(this,arguments),i=i||{},r.each(o,function(t){this[t]=i[t]||this[t]},this),this.initializeIMSwtch(),this.initializeIMVirtual(),this.initializeIMPipe()},executionType:"all",cases:{},when:function(t,i,e){return this.mainSwtch.when(t,i,e),this}});a.assignProto(t("./__improved-model/swtch")).assignProto(t("./__improved-model/virtual/prototype")).assignProto(t("./__improved-model/pipe")),a.assignStatic(t("./__improved-model/virtual/static"))});