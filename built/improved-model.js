//     improved-model
//     (c) simonfan
//     improved-model is licensed under the MIT terms.

define("__improved-model/model-swtch/build-condition",["require","exports","module","object-query","lodash"],function(e,t,i){function o(e){var t=e.split(s),i=r.map(t,function(e){var t={};return r.each(e.split(a),function(e){var i=e.split(l);if(!i[1])throw new Error("No value found for "+o+" criterion.");var o=i[0],n=i[1].split(c);t[o]=n.length>1?n:n[0]}),t});return i}var n=e("object-query"),r=e("lodash"),s=/\s*\|\|\s*/g,a=/\s*&&\s*/g,l=/\s*:\s*/g,c=/\s*\|\s*/g;i.exports=function(e,t){return r.isString(t)&&(t=o(t)),r.partial(n(t),e.attributes)}}),define("__improved-model/model-swtch/build-callback",["require","exports","module","lodash"],function(e,t,i){function o(e,t){e.set(t)}var n=e("lodash");i.exports=function(e,t){return n.isFunction(t)?n.partial(t,e):n.partial(o,e,t)}}),define("__improved-model/model-swtch/index",["require","exports","module","swtch","lodash","./build-condition","./build-callback"],function(e,t,i){{var o=e("swtch"),n=e("lodash"),r=e("./build-condition"),s=e("./build-callback"),a=o.prototype.initialize,l=o.prototype.when;i.exports=o.extend({initialize:function(e,t){this.model=t.model;var i;n.isArray(e)?i=e:(i=[],n.each(e,function(e,t){i.push({condition:t,value:e})})),a.call(this,i)},when:function(e,t){var i=n.toArray(arguments);if("default"!==e){var o=r(this.model,e),a=s(this.model,t);i=[o,a].concat(i.slice(2))}return l.apply(this,i)}})}}),define("__improved-model/swtch",["require","exports","module","./model-swtch/index"],function(e,t){var i=e("./model-swtch/index");t.swtch=function(e){var t=i(e,{model:this}),o="all"===this.executionType?t.exec:t.execFirst;return this.on("change",function(e){o.call(t,e.attributes)}),o.call(t,this.attributes),t}}),define("__improved-model/virtual",["require","exports","module","lodash"],function(e,t){function i(e){return e}function o(e,t,i){var o=n.map(t,this.get,this),r=i.apply(this,o);this.set(e,r)}var n=e("lodash");t.virtual=function(e,t,r){r=r||i,t=n.isArray(t)?t:[t];var s=n.map(t,function(e){return"change:"+e}).join(" ");this.on(s,n.partial(o,e,t,r),this),o.call(this,e,t,r)}}),define("improved-model",["require","exports","module","lowercase-backbone","lodash","./__improved-model/swtch","./__improved-model/virtual"],function(e,t,i){var o=e("lowercase-backbone"),n=e("lodash"),r=o.model.prototype.initialize,s=["cases","executionType"],a=i.exports=o.model.extend({initialize:function(e,t){r.apply(this,arguments),t=t||{},n.each(s,function(e){this[e]=t[e]||this[e]},this),this.mainSwtch=this.swtch(this.cases)},executionType:"all",cases:{},when:function(e,t,i){return this.mainSwtch.when(e,t,i),this}});a.assignProto(e("./__improved-model/swtch")).assignProto(e("./__improved-model/virtual"))});