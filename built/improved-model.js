//     improved-model
//     (c) simonfan
//     improved-model is licensed under the MIT terms.

define("__improved-model/model-swtch/build-condition",["require","exports","module","object-query","lodash"],function(t,e,i){function o(t){var e=t.split(s),i=n.map(e,function(t){var e={};return n.each(t.split(a),function(t){var i=t.split(l);if(!i[1])throw new Error("No value found for "+o+" criterion.");var o=i[0],r=i[1].split(u);e[o]=r.length>1?r:r[0]}),e});return i}var r=t("object-query"),n=t("lodash"),s=/\s*\|\|\s*/g,a=/\s*&&\s*/g,l=/\s*:\s*/g,u=/\s*\|\s*/g;i.exports=function(t,e){return n.isString(e)&&(e=o(e)),n.partial(r(e),t.attributes)}}),define("__improved-model/model-swtch/build-callback",["require","exports","module","lodash"],function(t,e,i){function o(t,e){t.set(e)}var r=t("lodash");i.exports=function(t,e){return r.isFunction(e)?r.partial(e,t):r.partial(o,t,e)}}),define("__improved-model/model-swtch/index",["require","exports","module","swtch","lodash","./build-condition","./build-callback"],function(t,e,i){{var o=t("swtch"),r=t("lodash"),n=t("./build-condition"),s=t("./build-callback"),a=o.prototype.initialize,l=o.prototype.when;i.exports=o.extend({initialize:function(t,e){this.model=e.model;var i;r.isArray(t)?i=t:(i=[],r.each(t,function(t,e){i.push({condition:e,value:t})})),a.call(this,i)},when:function(t,e){var i=r.toArray(arguments);if("default"!==t){var o=n(this.model,t),a=s(this.model,e);i=[o,a].concat(i.slice(2))}return l.apply(this,i)}})}}),define("__improved-model/swtch",["require","exports","module","./model-swtch/index"],function(t,e){var i=t("./model-swtch/index");e.swtch=function(t){var e=i(t,{model:this}),o="all"===this.executionType?e.exec:e.execFirst;return this.on("change",function(t){o.call(e,t.attributes)}),o.call(e,this.attributes),e}}),define("__improved-model/virtual",["require","exports","module","lodash"],function(t,e){function i(t){return t}function o(t,e,i,o){var r=n.map(i,t.get,t),s=o.apply(t,r);t.set(e,s)}function r(t,e,r,s){s=s||i,r=n.isArray(r)?r:[r];var a=n.map(r,function(t){return"change:"+t}).join(" ");t.on(a,n.partial(o,t,e,r,s)),o(t,e,r,s)}var n=t("lodash");e.virtual=function(){if(n.isObject(arguments[0]))n.each(arguments[0],function(t,e){r(this,e,t.src,t.processor)},this);else if(n.isString(arguments[0])){var t=n.toArray(arguments);t.unshift(this),r.apply(null,t)}return this}}),define("improved-model",["require","exports","module","lowercase-backbone","lodash","./__improved-model/swtch","./__improved-model/virtual"],function(t,e,i){var o=t("lowercase-backbone"),r=t("lodash"),n=o.model.prototype.initialize,s=["cases","executionType"],a=i.exports=o.model.extend({initialize:function(t,e){n.apply(this,arguments),e=e||{},r.each(s,function(t){this[t]=e[t]||this[t]},this),this.mainSwtch=this.swtch(this.cases),this.virtual(this.virtualAttributes)},virtualAttributes:{},executionType:"all",cases:{},when:function(t,e,i){return this.mainSwtch.when(t,e,i),this}});a.assignProto(t("./__improved-model/swtch")).assignProto(t("./__improved-model/virtual")),a.assignStatic("extendVirtualAttributes",function(t){var e=this.extend();return e.assignProto("virtualAttributes",t),e})});