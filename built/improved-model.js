//     Iterator
//     (c) simonfan
//     Iterator is licensed under the MIT terms.

//     Deep
//     (c) simonfan
//     Deep is licensed under the MIT terms.

//     Containers
//     (c) simonfan
//     Containers is licensed under the MIT terms.

//     ObjectMatcher
//     (c) simonfan
//     ObjectMatcher is licensed under the MIT terms.

//     improved-model
//     (c) simonfan
//     improved-model is licensed under the MIT terms.

define("iterator/base",["subject","lodash"],function(e,t){var r=e({initialize:function(e,t){this.data=e,t=t||{},this.currentIndex=t.startAt||-1,this.options=t,this.evaluate=t.evaluate||t.evaluator||this.evaluate},move:function(e){return this.index(this.currentIndex+e),this},evaluate:function(e){return e},evaluator:function(e){return this.evaluate=e,this},start:function(){return this.currentIndex=-1,this},end:function(){return this.currentIndex=this.length(),this},index:function(e){if(e>this.length()-1||0>e)throw new Error("No such index "+e);return this.currentIndex=e,this},countBefore:function(){return this.currentIndex+1},countAfter:function(){return this.length()-(this.currentIndex+1)},range:function(e,t){for(var r=[];t>=e;)r.push(this.at(e)),e++;return r},hasNext:function(){return this.currentIndex<this.length()-1},next:function(){return this.move(1),this.current()},nextN:function(e){for(var t=[],r=this.currentIndex+e-1;this.hasNext()&&this.currentIndex<=r;)t.push(this.next());return t},hasPrevious:function(){return this.currentIndex>0},previous:function(){return this.move(-1),this.current()},previousN:function(e){for(var t=[],r=this.currentIndex-e+1;this.hasPrevious()&&this.currentIndex>=r;)t.push(this.previous());return t},current:function(){return this.at(this.currentIndex)},value:function(){return this.data}});r.proto({hasPrev:r.prototype.hasPrevious,prev:r.prototype.previous,prevN:r.prototype.previousN});var n=["map","filter","compact","difference"];return t.each(n,function(e){r.proto(e,function(){var r=t(this.data);r=r[e].apply(r,arguments);var n=this.constructor(r.value());return n})}),r}),define("iterator/array",["require","exports","module","./base","lodash"],function(e){var t=e("./base"),r=e("lodash"),n=t.extend({at:function(e){return this.evaluate(this.data[e],e)},length:function(){return this.data.length}}),i=["push","reverse","shift","sort","splice","unshift"];return r.each(i,function(e){n.proto(e,function(){return this.data[e].apply(this.data,arguments),this})}),r.each(["concat","slice"],function(e){n.proto(e,function(){var t=this.data[e].apply(this.data,arguments);return this.constructor(t)})}),n}),define("iterator/object",["require","exports","module","./base","lodash"],function(e){var t=e("./base"),r=e("lodash"),n=t.extend({initialize:function(e,n){n=n||{},t.prototype.initialize.apply(this,arguments),this.order=n.order||r.keys(e)},keyAt:function(e){return this.order[e]},at:function(e){var t=this.keyAt(e),r=this.data[t];return this.evaluate(r,t)},length:function(){return this.order.length},nextKey:function(){return this.keyAt(this.currentIndex+1)},currentKey:function(){return this.keyAt(this.currentIndex)},previousKey:function(){return this.keyAt(this.currentIndex-1)},map:function(e){var t={};return r.each(this.order,function(r,n){t[r]=e(this.data[r],r,n)}.bind(this)),this.constructor(t)}});return n.proto("constructor",n),n}),define("itr",["require","exports","module","./iterator/array","./iterator/object","lodash"],function(e){var t=e("./iterator/array"),r=e("./iterator/object"),n=e("lodash"),i=function(e){var i;return n.isArray(e)?i=t:n.isObject(e)&&(i=r),i.apply(this,arguments)};return i.object=r,i.array=t,i}),define("__deep__/keys",["require","exports","module"],function(){return function(e){return e.replace(/\[(["']?)([^\1]+?)\1?\]/g,".$2").replace(/^\./,"").split(".")}}),define("__deep__/walker",["require","exports","module","lodash","itr","./keys"],function(e,t,r){var n=e("lodash"),i=e("itr"),o=e("./keys"),u=i.object.extend({nextStep:function(){var e=new RegExp("^"+this.currentKey()+"\\.");return this.nextKey().replace(e,"")},currentStep:function(){var e=new RegExp("^"+this.previousKey()+"\\.");return this.currentKey().replace(e,"")},previousStep:function(){var e=this.previousKey()||"";return n.last(e.split("."))},remainingSteps:function(){var e=new RegExp("^"+this.currentKey()+"\\.");return this.destination().replace(e,"")},destination:function(){return n.last(this.order)}});r.exports=function(e,t){t=n.isArray(t)?t:o(t);var r={"":e},i=[""];return n.every(t,function(o,u){var a=n.first(t,u+1).join(".");return i.push(a),e=e[o],r[a]=e,!n.isUndefined(e)}),u(r,{order:i})}}),define("__deep__/getset",["require","exports","module","lodash","./keys"],function(e,t){var r=e("lodash"),n=e("./keys");t.get=function(e,t){return t=r.isArray(t)?t:n(t),r.reduce(t,function(e,t){return e[t]},e)},t.set=function(e,i,o){i=r.isArray(i)?i:n(i);var u=i.pop();e=t.get(e,i),e[u]=o}}),define("deep",["require","exports","module","lodash","./__deep__/keys","./__deep__/walker","./__deep__/getset"],function(e){var t=e("lodash"),r={};return r.parseKeys=e("./__deep__/keys"),r.walker=e("./__deep__/walker"),t.extend(r,e("./__deep__/getset")),r}),define("containers",["lodash"],function(){function e(e,t){return _.all(t,function(t){return _.contains(e,t)})}function t(e,t){return _.any(t,function(t){return _.contains(e,t)})}function r(e,t){return e[0]<t&&t<e[1]}function n(e,t){return e[0]<=t&&t<=e[1]}function i(e,t,i){var o=i?r:n;return o=_.partial(o,e),_.isArray(t)?_.every(t,o):o(t)}return{containsAll:e,containsAny:t,exclusiveWithin:r,inclusiveWithin:n,within:i}}),define("__object-query__/operators/match",["require","exports","module","lodash"],function(e,t){var r=e("lodash");t.$matchSingle=function(e,t){return r.isRegExp(e)?e.test(t):e===t},t.$match=function(e,n){return r.isArray(n)?r.any(n,function(r){return t.$matchSingle(e,r)}):t.$matchSingle(e,n)}}),define("__object-query__/operators/range",["require","exports","module"],function(e,t){t.$lt=function(e,t){return e>t},t.$lte=function(e,t){return e>=t},t.$gt=function(e,t){return t>e},t.$gte=function(e,t){return t>=e}}),define("__object-query__/operators/set",["require","exports","module","lodash","containers"],function(e,t){var r=e("lodash"),n=e("containers");t.$in=function(e,t){return r.isArray(t)?n.containsAny(e,t):r.contains(e,t)},t.$nin=function(e,t){return r.isArray(t)?!n.containsAny(e,t):!r.contains(e,t)},t.$all=function(e,t){return n.containsAll(t,e)}}),define("__object-query__/operators/boolean",["require","exports","module"],function(e,t){t.$e=function(){},t.$ne=function(){},t.$not=function(){},t.$or=function(){},t.$and=function(){},t.$exists=function(){}}),define("__object-query__/operators/index",["require","exports","module","lodash","deep","containers","./match","./range","./set","./boolean"],function(e,t){var r=e("lodash");e("deep"),e("containers"),r.extend(t,e("./match"),e("./range"),e("./set"),e("./boolean")),t.evaluateValue=function(e,n){return r.isObject(e)&&!r.isRegExp(e)?r.every(e,function(e,r){var i=t[r];if(i)return i(e,n);throw new Error("The operator "+r+" is not supported by object-query.")}):t.$match(e,n)}}),define("__object-query__/match",["require","exports","module","lodash","deep","./operators/index"],function(e,t,r){var n=e("lodash"),i=e("deep"),o=e("./operators/index"),u=/[0-9]+/,a=function(e,t,r){return n.any(t,function(t){return s(e,t,r)})},s=r.exports=function(e,t,r){for(var s,c=i.walker(t,r);c.hasNext();){var h=c.next();if(!c.hasNext()){s=o.evaluateValue(e,h);break}if(n.isArray(h)&&!u.test(c.nextStep())){s=a(e,h,c.remainingSteps());break}}return s}}),define("__object-query__/find",["require","exports","module","lodash","deep","./operators/index"],function(e,t,r){var n=e("lodash"),i=e("deep"),o=e("./operators/index"),u=/[0-9]+/,a=function(e,t,r){return n.any(t,function(t){return s(e,t,r)})},s=r.exports=function(e,t,r){for(var s,c=i.walker(t,r);c.hasNext();){var h=c.next();if(!c.hasNext()){s=o.evaluateValue(e,h);break}if(n.isArray(h)&&!u.test(c.nextStep())){s=a(e,h,c.remainingSteps());break}}return s}}),define("object-query",["require","exports","module","lodash","./__object-query__/match","./__object-query__/find"],function(e){function t(e,t){return n.every(e,function(e,r){return i(e,t,r)})}function r(e,r){return n.isArray(e)?n.any(e,function(e){return t(e,r)}):t(e,r)}var n=e("lodash"),i=e("./__object-query__/match");e("./__object-query__/find");var o=function(e){return e=e||{},n.partial(r,e)},u=["every","all","some","any","filter","find","reject"];return n.each(u,function(e){o[e]=function(t,r){return n[e](t,o(r))}}),o}),define("__improved-model/when/build-condition",["require","exports","module","object-query","lodash"],function(e,t,r){function n(e){var t=e.split(u),r=o.map(t,function(e){var t={};return o.each(e.split(a),function(e){var r=e.split(s);if(!r[1])throw new Error("No value found for "+n+" criterion.");var n=r[0],i=r[1].split(c);t[n]=i.length>1?i:i[0]}),t});return r}var i=e("object-query"),o=e("lodash"),u=/\s*\|\|\s*/g,a=/\s*&&\s*/g,s=/\s*:\s*/g,c=/\s*\|\s*/g;r.exports=function(e){return o.isString(e)&&(e=n(e)),i(e)}}),define("__improved-model/when/index",["require","exports","module","lodash","./build-condition"],function(e,t){function r(e,t,r,n){t(e.attributes)&&r.apply(n,[e])}function n(e,t,n){var i=s(e);this.on("change",a.partial(r,this,i,t,n),this)}function i(e,t){var r=a.partial(this.set,t);n.call(this,e,r,this)}function o(e,t,n){var i=s(t);context=context||this,this.listenTo(e,"change",a.partial(r,e,i,n,this))}function u(e,t,r){var n=a.partial(this.set,r);o.call(this,t,n,this)}var a=e("lodash"),s=e("./build-condition");t.when=function(e,t){return a.isFunction(t)?n.apply(this,arguments):a.isObject(t)&&i.apply(this,arguments),this},t.whenOther=function(e,t,r){a.isFunction(r)?o.apply(this,arguments):a.isObject(r)&&u.apply(this,arguments)}}),define("improved-model",["require","exports","module","lowercase-backbone","./__improved-model/when/index"],function(e,t,r){var n=e("lowercase-backbone"),i=r.exports=n.model.extend({});i.assignProto(e("./__improved-model/when/index"))});