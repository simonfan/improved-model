//     improved-model
//     (c) simonfan
//     improved-model is licensed under the MIT terms.

define("__improved-model/model-swtch/build-condition",["require","exports","module","object-query","lodash"],function(t,e,i){function r(t){var e=t.split(s),i=o.map(e,function(t){var e={};return o.each(t.split(a),function(t){var i=t.split(l);if(!i[1])throw new Error("No value found for "+r+" criterion.");var r=i[0],n=i[1].split(u);e[r]=n.length>1?n:n[0]}),e});return i}var n=t("object-query"),o=t("lodash"),s=/\s*\|\|\s*/g,a=/\s*&&\s*/g,l=/\s*:\s*/g,u=/\s*\|\s*/g;i.exports=function(t,e){return o.isString(e)&&(e=r(e)),o.partial(n(e),t.attributes)}}),define("__improved-model/model-swtch/build-callback",["require","exports","module","lodash"],function(t,e,i){function r(t,e){t.set(e)}var n=t("lodash");i.exports=function(t,e){return n.isFunction(e)?n.partial(e,t):n.partial(r,t,e)}}),define("__improved-model/model-swtch/index",["require","exports","module","swtch","lodash","./build-condition","./build-callback"],function(t,e,i){{var r=t("swtch"),n=t("lodash"),o=t("./build-condition"),s=t("./build-callback"),a=r.prototype.initialize,l=r.prototype.when;i.exports=r.extend({initialize:function(t,e){this.model=e.model;var i;n.isArray(t)?i=t:(i=[],n.each(t,function(t,e){i.push({condition:e,value:t})})),a.call(this,i)},when:function(t,e){var i=n.toArray(arguments);if("default"!==t){var r=o(this.model,t),a=s(this.model,e);i=[r,a].concat(i.slice(2))}return l.apply(this,i)}})}}),define("__improved-model/swtch",["require","exports","module","./model-swtch/index"],function(t,e){var i=t("./model-swtch/index");e.swtch=function(t){var e=i(t,{model:this}),r="all"===this.executionType?e.exec:e.execFirst;return this.on("change",function(t){r.call(e,t.attributes)}),r.call(e,this.attributes),e}}),define("__improved-model/virtual",["require","exports","module","lodash"],function(t,e){function i(t){return t}function r(t,e,i,r){var n=o.map(i,t.get,t),s=r.apply(t,n);t.set(e,s)}function n(t,e,n,s){s=s||i,n=o.isArray(n)?n:[n];var a=o.map(n,function(t){return"change:"+t}).join(" ");t.on(a,o.partial(r,t,e,n,s)),r(t,e,n,s)}var o=t("lodash");e.virtual=function(){if(o.isObject(arguments[0]))o.each(arguments[0],function(t,e){n(this,e,t.src,t.processor)},this);else if(o.isString(arguments[0])){var t=o.toArray(arguments);t.unshift(this),n.apply(null,t)}return this}}),define("improved-model",["require","exports","module","lowercase-backbone","lodash","./__improved-model/swtch","./__improved-model/virtual"],function(t,e,i){var r=t("lowercase-backbone"),n=t("lodash"),o=r.model.prototype.initialize,s=["cases","executionType"],a=i.exports=r.model.extend({initialize:function(t,e){o.apply(this,arguments),e=e||{},n.each(s,function(t){this[t]=e[t]||this[t]},this),this.mainSwtch=this.swtch(this.cases),this.virtual(this.virtualAttributes)},virtualAttributes:{},executionType:"all",cases:{},when:function(t,e,i){return this.mainSwtch.when(t,e,i),this}});a.assignProto(t("./__improved-model/swtch")).assignProto(t("./__improved-model/virtual")),a.assignStatic({extendVirtualAttributes:function(t){var e=this.extend();return e.defineVirtualAttributes(t),e},defineVirtualAttributes:function(t){return this.prototype.virtualAttributes=t,this}})});