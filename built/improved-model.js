//     pipe
//     (c) simonfan
//     pipe is licensed under the MIT terms.

//     improved-model
//     (c) simonfan
//     improved-model is licensed under the MIT terms.

define("__improved-model/model-swtch/build-condition",["require","exports","module","object-query","lodash"],function(t,i,e){function s(t){var i=t.split(o),e=r.map(i,function(t){var i={};return r.each(t.split(a),function(t){var e=t.split(u);if(!e[1])throw new Error("No value found for "+s+" criterion.");var s=e[0],n=e[1].split(c);i[s]=n.length>1?n:n[0]}),i});return e}var n=t("object-query"),r=t("lodash"),o=/\s*\|\|\s*/g,a=/\s*&&\s*/g,u=/\s*:\s*/g,c=/\s*\|\s*/g;e.exports=function(t,i){return r.isString(i)&&(i=s(i)),r.partial(n(i),t.attributes)}}),define("__improved-model/model-swtch/build-callback",["require","exports","module","lodash"],function(t,i,e){function s(t,i){t.set(i)}var n=t("lodash");e.exports=function(t,i){return n.isFunction(i)?n.partial(i,t):n.partial(s,t,i)}}),define("__improved-model/model-swtch/index",["require","exports","module","swtch","lodash","./build-condition","./build-callback"],function(t,i,e){{var s=t("swtch"),n=t("lodash"),r=t("./build-condition"),o=t("./build-callback"),a=s.prototype.initialize,u=s.prototype.when;e.exports=s.extend({initialize:function(t,i){this.model=i.model;var e;n.isArray(t)?e=t:(e=[],n.each(t,function(t,i){e.push({condition:i,value:t})})),a.call(this,e)},when:function(t,i){var e=n.toArray(arguments);if("default"!==t){var s=r(this.model,t),a=o(this.model,i);e=[s,a].concat(e.slice(2))}return u.apply(this,e)}})}}),define("__improved-model/swtch",["require","exports","module","./model-swtch/index"],function(t,i){var e=t("./model-swtch/index");i.initializeIMSwtch=function(){this.mainSwtch=this.swtch(this.cases)},i.swtch=function(t){var i=e(t,{model:this}),s="all"===this.executionType?i.exec:i.execFirst;return this.on("change",function(t){s.call(i,t.attributes)}),s.call(i,this.attributes),i}}),define("__improved-model/virtual",["require","exports","module","lodash"],function(t,i){function e(t){return t}function s(t,i,e,s){var n=r.map(e,t.get,t),o=s.apply(t,n);t.set(i,o)}function n(t,i,n,o){o=o||e,n=r.isArray(n)?n:[n];var a=r.map(n,function(t){return"change:"+t}).join(" ");t.on(a,r.partial(s,t,i,n,o)),s(t,i,n,o)}var r=t("lodash");i.initializeIMVirtual=function(){this.virtual(this.virtualAttributes)},i.virtual=function(){if(r.isObject(arguments[0]))r.each(arguments[0],function(t,i){n(this,i,t.src,t.processor)},this);else if(r.isString(arguments[0])){var t=r.toArray(arguments);t.unshift(this),n.apply(null,t)}return this}}),define("__pipe/streams/pump",["require","exports","module","lodash"],function(t,i,e){function s(t,i,e){n.each(e,function(e){return this._destSet(i,e,t)},this)}var n=t("lodash");e.exports=function(t,i,e){var n=this.destination,r=this._srcGet(this.source,t);(!this.isCached(t,r)||e)&&s.call(this,r,n,i)}}),define("__pipe/streams/drain",["require","exports","module","lodash"],function(t,i,e){t("lodash"),e.exports=function(t,i,e){var s=this._destGet(this.destination,i[0]);return(!this.isCached(t,s)||e)&&this._srcSet(this.source,t,s),this}}),define("__pipe/streams/index",["require","exports","module","lodash","./pump","./drain"],function(t,i){function e(t,i,e){return i=i?s.pick(this._map,i):this._map,s.each(i,function(i,s){t.call(this,s,i,e)},this),this}var s=t("lodash");i.pump=s.partial(e,t("./pump")),i.drain=s.partial(e,t("./drain")),i.inject=function(t,i){if(!this.source)throw new Error("No source for pipe");s.each(t,function(t,e){(!this.isCached(e,t)||i)&&this._srcSet(this.source,e,t)},this),this.pump(null,!0)}}),define("__pipe/mapping",["require","exports","module","lodash"],function(t,i){var e=t("lodash");i.map=function(){var t,i;return e.isString(arguments[0])?(t=arguments[0],i=arguments[1]||t,i=e.isArray(i)?i:[i],this._map[t]=i):e.isObject(arguments[0])&&e.each(arguments[0],function(t,i){this.map(i,t)},this),this},i.removeLine=function(t){return delete this._map[t],this}}),define("pipe",["require","exports","module","subject","lodash","./__pipe/streams/index","./__pipe/mapping"],function(t,i,e){var s=t("subject"),n=t("lodash"),r=["srcGet","srcSet","destGet","destSet"],o=e.exports=s({initialize:function(t,i){i=i||{},n.each(r,function(t){this[t]=i[t]||this[t]},this),this._srcGet=this.srcGet||this.get,this._srcSet=this.srcSet||this.set,this._destGet=this.destGet||this.get,this._destSet=this.destSet||this.set,i.cache!==!1&&this.clearCache(),i.source&&this.from(i.source),i.destination&&this.to(i.destination),this._map={},this.map(t)},get:function(t,i){return t[i]},set:function(t,i,e){return t[i]=e,t},clearCache:function(){return this.cache={},this},isCached:function(t,i){return this.cache?this.cache[t]!==i?(this.cache[t]=i,!1):!0:!1},to:function(t){return this.clearCache(),this.destination=t,this},from:function(t){return this.clearCache(),this.source=t,this}});o.assignProto(t("./__pipe/streams/index")).assignProto(t("./__pipe/mapping"))}),define("__improved-model/pipe",["require","exports","module","pipe","lodash"],function(t,i){var e=t("pipe"),s=t("lodash"),n=e.extend({get:function(t,i){return t.get(i)},set:function(t,i,e){return t.set(i,e)}});i.initializeIMPipe=function(){s.bindAll(this,["pump"]),this.pipes=[],this.on("change",this.pump)},i.pump=function(){return s.each(this.pipes,function(t){t.pump()}),this},i.pipe=function(t,i){if(s.isString(t)){var e=t;t={},t[e]=e}i=i||{},i.source=this;var r=n(t,i);return this.pipes.push(r),r}}),define("improved-model",["require","exports","module","lowercase-backbone","lodash","./__improved-model/swtch","./__improved-model/virtual","./__improved-model/pipe"],function(t,i,e){var s=t("lowercase-backbone"),n=t("lodash"),r=s.model.prototype.initialize,o=["cases","executionType"],a=e.exports=s.model.extend({initialize:function(t,i){r.apply(this,arguments),i=i||{},n.each(o,function(t){this[t]=i[t]||this[t]},this),this.initializeIMSwtch(),this.initializeIMVirtual(),this.initializeIMPipe()},virtualAttributes:{},executionType:"all",cases:{},when:function(t,i,e){return this.mainSwtch.when(t,i,e),this}});a.assignProto(t("./__improved-model/swtch")).assignProto(t("./__improved-model/virtual")).assignProto(t("./__improved-model/pipe")),a.assignStatic({extendVirtualAttributes:function(t){var i=this.extend();return i.defineVirtualAttributes(t),i},defineVirtualAttributes:function(t){return this.prototype.virtualAttributes=t,this}})});